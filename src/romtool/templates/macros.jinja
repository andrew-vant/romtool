{%- macro toclist(title, id, dct) -%}
<li><a href="#{{ id }}">{{ title }}</a>
  <ol>
    {%- for key, item in dct.items() %}
    <li><a href="#{{ id }}-{{ key }}">{{ item | name | title }}</a></li>
    {%- endfor %}
  </ol>
</li>
{%- endmacro -%}


{%- macro structtable(struct, classes) -%}
{%- set content = [] %}
{%- for field in struct.fields %}
{%- do content.append(field | asdict) %}
{%- endfor %}
{{ mappingtable(content, classes, struct.fields[0] | asdict) }}
{%- endmacro -%}

{%- macro tablespecs(tables, classes) -%}
{%- set content = [] %}
{%- for table in tables %}
{%- do content.append(table | asdict) %}
{%- endfor %}
{{ mappingtable(content, classes) }}
{%- endmacro -%}

{%- macro datatable(table) -%}
{%- set index = table._index %}
{%- set stride = table.size or index.stride or null %}
<h3 id="table-{{ table.id }}">{{ table.spec.name }}</h3>
<p>
{{ table.comment }}
{{ table | length }}
{% if stride %}{{ stride }}-byte{% endif %}
items of type <span class="type">{{ table.spec.type }}</span>.
{%- if table.has_index %}
{%- set endian = 'little-endian' if index.spec.type.endswith('le')
                 else 'big-endian' if index.spec.type.endswith('be')
                 else '' %}
The table index begins at <span class="offset">{{ index.spec.offset }}</span>;
index entries are {{ index.spec.stride }}-byte {{ endian }}
integer offsets relative to <span class="offset">{{ table.spec.offset }}</span>.
{%- else %}
There is no table index; items start at <span class="offset">
{{ table.spec.offset }}</span> and appear sequentially after that.
{%- endif %}
</p>
{{ table }}
{%- endmacro -%}

{%- macro tbl2html(rows, caption) -%}
{%- set headers = rows[0] | list %}
<table>
  {%- if caption is defined and caption %}
  <caption>{{ caption }}</caption>
  {%- endif %}
  <thead>
    <tr>
      <td>#</td>
      {%- for header in headers %}
      <td>{{ header }}</td>
      {%- endfor %}
    </tr>
  </thead>
  <tbody>
    {%- for row in rows %}
    <tr>
      <td>{{ loop.index0 }}</td>
      {%- for header in headers %}
      <td>{{ row[header] }}</td>
      {%- endfor %}
    </tr>
    {%- endfor %}
  </tbody>
</table>
{%- endmacro -%}

{%- macro tsvtable(caption, headers, rows) -%}
<table>
  {%- if caption is defined and caption %}
  <caption>{{ caption }}</caption>
  {%- endif %}
  <thead>
    <tr>
      {%- for header in headers %}
      <td>{{ header }}</td>
      {%- endfor %}
    </tr>
  </thead>
  <tbody>
    {%- for row in rows %}
    <tr>
      {%- for value in row %}
      <td>{{ value }}</td>
      {%- endfor %}
    </tr>
    {%- endfor %}
  </tbody>
</table>
{%- endmacro -%}

{%- macro hid(identifier) %}
{{ '{#' + identifier + '}' }}
{%- endmacro %}
